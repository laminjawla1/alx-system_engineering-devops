global
    log /dev/log		local0
    maxconn 			2048
    user    			haproxy
    group   			haproxy
    tune.ssl.default-dh-param 	2048

defaults
    log     	global
    mode    	http
    option  	httplog
    option  	dontlognull
    retries 	3
    option  	redispatch
    timeout 	connect  		5000
    timeout 	client  		10000
    timeout 	server  		10000
    option  	forwardfor
    option  	http-server-close
    errorfile 	400 			/etc/haproxy/errors/400.http
    errorfile 	403 			/etc/haproxy/errors/403.http
    errorfile 	408 			/etc/haproxy/errors/408.http
    errorfile 	500 			/etc/haproxy/errors/500.http
    errorfile 	502 			/etc/haproxy/errors/502.http
    errorfile 	503 			/etc/haproxy/errors/503.http
    errorfile 	504 			/etc/haproxy/errors/504.http

frontend laminjawla-http
    bind		*:80
    http-request	set-header	X-Forwarded-Proto	http
    default_backend	www-backend

frontend laminjawla-https
    bind *:443 ssl crt /etc/letsencrypt/archive/www.laminjawla.tech/www.laminjawla.tech.pem
    http-request add-header X-Forwarded-Proto https
    acl    letsencrypt-acl path_beg /.well-known/acme-challenge/
    use_backend letsencrypt-backend if letsencrypt-acl
    default_backend laminjawla-backend

backend laminjawla-backend
    balance  roundrobin
    redirect scheme https if !{ ssl_fc }
    server 374236-web-01 54.160.88.197:80 check
    server 374236-web-02 52.91.178.63:80 check

backend letsencrypt-backend
    server letsencrypt 127.0.0.1:54321
